---
// Gallery.astro
const images = [
  { src: "/mariafer/mariaFerBando.jpg", alt: "Couple laughing together in nature" },
  { src: "/mariafer/mariaFerBodaSelfie.jpg", alt: "Couple holding hands close up" },
  { src: "/mariafer/mariaFerSelfieMar.jpg", alt: "Couple portrait in golden hour" },
  { src: "/mariafer/mariaFerMoto.jpg", alt: "Couple on motorcycle adventure" },
  { src: "/mariafer/mariaFerPlaya.jpg", alt: "Couple portrait at the beach" },
];
---

<section id="gallery" class="gallery-carousel">
  <div class="gallery-carousel__container">
    <h2 class="gallery-carousel__heading">Galer√≠a</h2>
    
    <div class="gallery-carousel__carousel">
      <!-- Slides -->
      <div class="gallery-carousel__track" id="carouselTrack">
        {images.map((image) => (
          <div class="gallery-carousel__slide">
            <button 
              class="gallery-carousel__button" 
              data-image={image.src}
              data-alt={image.alt}
              aria-label={`View ${image.alt}`}
            >
              <img
                src={image.src}
                alt={image.alt}
                class="gallery-carousel__image"
                loading="lazy"
              />
            </button>
          </div>
        ))}
      </div>

      <!-- Navigation Dots -->
      <div class="gallery-carousel__dots" id="carouselDots"></div>

      <!-- Navigation Arrows -->
      <button class="gallery-carousel__prev" id="prevBtn" aria-label="Previous slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <button class="gallery-carousel__next" id="nextBtn" aria-label="Next slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="lightbox__close" aria-label="Close lightbox">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6 6 18M6 6l12 12"></path>
      </svg>
    </button>
    <img src="" alt="" class="lightbox__image" />
  </div>
</section>

<script>
  // Carousel functionality
  const track = document.getElementById('carouselTrack');
  const slides = track?.querySelectorAll('.gallery-carousel__slide');
  const dotsContainer = document.getElementById('carouselDots');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = lightbox?.querySelector('.lightbox__image');
  const closeButton = lightbox?.querySelector('.lightbox__close');

  if (slides && track && dotsContainer) {
    const slideCount = slides.length;
    let currentIndex = 0;

    // Create dots
    for (let i = 0; i < slideCount; i++) {
      const dot = document.createElement('button');
      dot.className = 'gallery-carousel__dot';
      dot.setAttribute('data-slide', i.toString());
      dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
      dotsContainer.appendChild(dot);
    }

    const dots = dotsContainer.querySelectorAll('.gallery-carousel__dot');

    // Go to slide function
    const goToSlide = (index) => {
      if (track) {
        track.style.transform = `translateX(-${index * 100}%)`;
      }
      currentIndex = index;
      updateDots();
    };

    // Update dots
    const updateDots = () => {
      dots.forEach((dot, i) => {
        dot.classList.toggle('gallery-carousel__dot--active', i === currentIndex);
      });
    };

    // Navigation
    nextBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % slideCount;
      goToSlide(currentIndex);
    });

    prevBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + slideCount) % slideCount;
      goToSlide(currentIndex);
    });

    // Dots navigation
    dots.forEach((dot, i) => {
      dot.addEventListener('click', () => goToSlide(i));
    });

    // Auto-advance
    let autoAdvance = setInterval(() => {
      currentIndex = (currentIndex + 1) % slideCount;
      goToSlide(currentIndex);
    }, 4000);

    // Pause on hover
    const carousel = document.querySelector('.gallery-carousel__carousel');
    carousel?.addEventListener('mouseenter', () => clearInterval(autoAdvance));
    carousel?.addEventListener('mouseleave', () => {
      autoAdvance = setInterval(() => {
        currentIndex = (currentIndex + 1) % slideCount;
        goToSlide(currentIndex);
      }, 4000);
    });
  }

  // Lightbox functionality (same as before)
  const galleryButtons = document.querySelectorAll('.gallery-carousel__button');
  galleryButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      const imageSrc = button.getAttribute('data-image');
      const imageAlt = button.getAttribute('data-alt');
      
      if (lightboxImage && imageSrc && imageAlt) {
        lightboxImage.src = imageSrc;
        lightboxImage.alt = imageAlt;
        lightbox?.classList.add('lightbox--active');
        lightbox?.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      }
    });
  });

  const closeLightbox = () => {
    lightbox?.classList.remove('lightbox--active');
    lightbox?.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  };

  closeButton?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && lightbox?.classList.contains('lightbox--active')) {
      closeLightbox();
    }
  });
</script>

<style>
  .gallery-carousel {
    padding: 6rem 1rem;
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 50%, #f1f5f9 100%);
  }

  .gallery-carousel__container {
    max-width: 72rem;
    margin: 0 auto;
  }

  .gallery-carousel__heading {
    font-family: serif;
    font-size: 3rem;
    font-weight: 300;
    text-align: center;
    margin-bottom: 4rem;
    color: #1a1a1a;
  }

  @media (min-width: 768px) {
    .gallery-carousel__heading {
      font-size: 3.75rem;
    }
  }

  /* Carousel Container */
  .gallery-carousel__carousel {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    border-radius: 1.5rem;
    overflow: hidden;
    box-shadow: 0 0 50px 10px rgba(0, 0, 0, 0.15);
  }

  /* Track */
  .gallery-carousel__track {
    display: flex;
    height: 500px;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }

  @media (max-width: 767px) {
    .gallery-carousel__track {
      height: 300px;
    }
  }

  /* Slides */
  .gallery-carousel__slide {
    flex: 0 0 100%;
    position: relative;
  }

  .gallery-carousel__button {
    width: 100%;
    height: 100%;
    padding: 0;
    border: none;
    background: none;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .gallery-carousel__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    transition: transform 0.4s ease;
    display: block;
  }

  .gallery-carousel__button:hover .gallery-carousel__image {
    transform: scale(1.05);
  }

  /* Navigation Arrows */
  .gallery-carousel__prev,
  .gallery-carousel__next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .gallery-carousel__prev {
    left: 16px;
  }

  .gallery-carousel__next {
    right: 16px;
  }

  .gallery-carousel__prev:hover,
  .gallery-carousel__next:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }

  /* Dots */
  .gallery-carousel__dots {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    padding: 2rem 1rem;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
  }

  .gallery-carousel__dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: none;
    background: rgba(107, 114, 128, 0.5);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .gallery-carousel__dot--active {
    background: #3b82f6;
    transform: scale(1.2);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
  }

  /* Lightbox (same as before) */
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 100;
    background-color: rgba(0, 0, 0, 0.9);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .lightbox--active {
    display: flex;
  }

  .lightbox__close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    z-index: 101;
  }

  .lightbox__close:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .lightbox__close svg {
    width: 1.5rem;
    height: 1.5rem;
  }

  .lightbox__image {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 0.5rem;
  }
</style>
